#!/usr/bin/make -f
# -*- makefile -*-
# This debian/rules uses debhelper.
# 
# This file was originally written by Joey Hess and Craig Small.
# As a special exception, when this file is copied by dh-make into a
# dh-make output file, you may use that output file without restriction.
# This special exception was added by Craig Small in version 0.37 of dh-make.
#
# The file you're reading now was modified by John Weiss.

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

# [jpw]  Centralize paths:  define some envvars for paths used in the rules
#        below.
export acINSTALLROOT=debian/msnek4k-driverd
export acPREFIX=${acINSTALLROOT}/usr
export acDOCDIR=${acPREFIX}/share/doc/msnek4k-driverd


%:
	dh $@

clean:
	-rm -r debian/files ${acINSTALLROOT}/DEBIAN
	-test -r Makefile && $(MAKE) distclean

# [jpw]  The normal "dh_install" rule copies /etc/msnek4k_driverd.conf to the
# 		 docdir, then gzips it.  I don't want that.
override_dh_install:

# [jpw]  Minor tweak to how "dh_installchangelogs" runs
override_dh_installchangelogs:
	dh_installchangelogs -k

# [jpw]	 I also don't want anything in the ${docdir}/examples directory
# 		 gzipped.  So, brute-force it.
override_dh_compress:
	dh_compress
	-gunzip ${acDOCDIR}/examples/*.gz

# [jpw]  Copy over the 'postinst' script autogenerated by 'configure'.
override_dh_installdebconf:
	-true || mv debian/postinst debian/postinst~
	cp pkgTemplates/debian.postinst debian/postinst
	dh_installdebconf

# [jpw]  Un"fix" the permissions on the binary, restoring setuid-root.
override_dh_fixperms:
	dh_fixperms
	chmod 6711 ${acPREFIX}/bin/msnek4k_driverd

# [jpw]  The default 'dh_installdeb' appends a list of everything in
#        ${prefix}/etc to the "DEBIAN/conffiles" file.  That's not what I
#        want.  It also copies debian/conffiles into the package's "DEBIAN"
#        subdir first.  You can only change the behavior of 'dh_installdeb' by
#        changing the compatability level ... which I also don't want to do.
#        So, I'll brute-force it.
override_dh_installdeb:
	dh_installdeb
	-cp debian/conffiles ${acINSTALLROOT}/DEBIAN/

